<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Ka Ka Blog]]></title>
  <link href="http://huxinghai1988.github.com/atom.xml" rel="self"/>
  <link href="http://huxinghai1988.github.com/"/>
  <updated>2016-09-07T21:53:53+08:00</updated>
  <id>http://huxinghai1988.github.com/</id>
  <author>
    <name><![CDATA[kaka]]></name>
    <email><![CDATA[huxinghai1988@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ä½¿ç”¨MySQLå­˜å‚¨emojiè¡¨æƒ…ç¬¦å·]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/09/05/mysql-store-emoji-in-rails-app/"/>
    <updated>2016-09-05T22:40:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/09/05/mysql-store-emoji-in-rails-app</id>
    <content type="html"><![CDATA[<p>ä¸€ä¸ªemojiæ˜¯4bytesçš„å­˜å‚¨ç©ºé—´, å¦‚æœä½ çš„MySQLä½¿ç”¨çš„æ˜¯utf8ç¼–ç æ ¼å¼é‚£emojiç¬¦å·å­˜å‚¨å°†ä¼šæˆªæ–­å­—ç¬¦å› ä¸ºutf8ä¸€ä¸ªå­—ç¬¦åªæ˜¯
3bytesçš„å­˜å‚¨ç©ºé—´</p>

<p>ä¾‹å­ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; SET NAMES utf8;
</span><span class='line'>Query OK, 0 rows affected (0,00 sec)
</span><span class='line'>
</span><span class='line'>mysql&gt; INSERT INTO messages (message) VALUES ('What a nice emojiğŸ˜€!');
</span><span class='line'>Query OK, 1 row affected, 1 warning (0,00 sec)
</span><span class='line'>
</span><span class='line'>mysql&gt; SHOW WARNINGS;
</span><span class='line'>+---------+------+---------------------------------------------------------------------------+
</span><span class='line'>| Level   | Code | Message                                                                   |
</span><span class='line'>+---------+------+---------------------------------------------------------------------------+
</span><span class='line'>| Warning | 1366 | Incorrect string value: '\xF0\x9F\x98\x80!' for column 'message' at row 1 |
</span><span class='line'>+---------+------+---------------------------------------------------------------------------+
</span><span class='line'>1 row in set (0,00 sec)
</span><span class='line'>
</span><span class='line'>mysql&gt; SELECT message FROM messages;
</span><span class='line'>+-------------------+
</span><span class='line'>| message           |
</span><span class='line'>+-------------------+
</span><span class='line'>| What a nice emoji |
</span><span class='line'>+-------------------+
</span><span class='line'>1 row in set (0,00 sec)</span></code></pre></td></tr></table></div></figure>


<p>ä½¿ç”¨utf8mb4æ ¼å¼å¯ä»¥å­˜å‚¨emojiå­—ç¬¦ï¼Œä½†æ˜¯<a href="https://dev.mysql.com/doc/relnotes/mysql/5.5/en/news-5-5-3.html">MySQL 5.5.3</a>ç‰ˆæœ¬æ‰å¼•è¿›utf8mb4ç¼–ç æ ¼å¼ï¼Œæ‰€ä»¥æ•°æ®åº“è¦æ›´æ–°åˆ°è¿™ä¸ªç‰ˆæœ¬æˆ–è€…æ›´é«˜çš„, ç”¨utf8mb4ä¹‹åæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°<code>Mysql2::Error: Specified key was too long; max key length is 767 bytes</code>é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºInnodbçš„ç´¢å¼•é•¿åº¦é™åˆ¶767bytes, (varchar(255) * 4bytes)è¿™ä¸ªæ˜¯ä¼šè¶…è¿‡767bytes</p>

<p>å¦‚æœä½ çš„å­—æ®µç±»å‹é•¿åº¦ä¸èƒ½å‡å°‘ï¼Œé‚£åªèƒ½æ˜¯æŒ‡å®šè¡Œçš„æ ¼å¼æ¥è§£å†³ï¼Œåœ¨åˆ›å»ºè¡¨æ—¶æŒ‡å®š<a href="http://dev.mysql.com/doc/refman/5.6/en/innodb-parameters.html#sysvar_innodb_large_prefix">ROW_FORMAT=DYNAMIC</a>å‚æ•°å¯ä»¥ä»767bytesé™åˆ¶æå‡åˆ°3072bytes, è¿™æ ·å°±æ˜¯ä¼šç‰ºç‰²ä¸€ç‚¹ç©ºé—´</p>

<p>ä¾‹å¦‚:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">bookmarks</span><span class="o">`</span> <span class="p">(</span>
</span><span class='line'>  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
</span><span class='line'>  <span class="o">`</span><span class="n">url</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">COLLATE</span> <span class="n">utf8mb4_bin</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>  <span class="o">`</span><span class="n">title</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">COLLATE</span> <span class="n">utf8mb4_bin</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>  <span class="o">`</span><span class="n">user_id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>  <span class="o">`</span><span class="n">created_at</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>  <span class="o">`</span><span class="n">updated_at</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>  <span class="o">`</span><span class="n">site_info_id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">25</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8mb4_bin</span> <span class="n">ROW_FORMAT</span><span class="o">=</span><span class="k">DYNAMIC</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœä½¿ç”¨çš„æ˜¯Railsçš„migrationçš„è¯å°±å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">CreateArticles</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="o">[</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">change</span>
</span><span class='line'>    <span class="n">create_table</span> <span class="ss">:articles</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="s1">&#39;ROW_FORMAT=DYNAMIC&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:title</span><span class="p">,</span> <span class="n">null</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">300</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">datetime</span> <span class="ss">:published</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:author</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">text</span> <span class="ss">:description</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">text</span> <span class="ss">:content</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">add_index</span> <span class="ss">:articles</span><span class="p">,</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:unique</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä½¿ç”¨Ruby MonitorMixinæ³¨æ„çš„å‘]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/08/20/ruby-monitor-mixin/"/>
    <updated>2016-08-20T21:40:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/08/20/ruby-monitor-mixin</id>
    <content type="html"><![CDATA[<p>åˆæ¬¡ä½¿ç”¨MonitorMixinæ§åˆ¶åŒæ­¥æ‰§è¡Œçš„æ—¶å€™ä¸€ä¸å°å¿ƒå°±è¸©å‘äº†ï¼Œå½“ä½ includeçš„æ—¶å€™å¦‚æœä½ çš„classå®šä¹‰äº†initializeæ–¹æ³•
è¯·è°ƒç”¨<code>super</code>å¦åˆ™ä¼šæŠ¥<code>undefined method `lock' for nil:NilClass</code>é”™ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Number</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:n</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">include</span> <span class="no">MonitorMixin</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@n</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">super</span><span class="p">()</span> <span class="c1"># è°ƒç”¨MonitorMixin#initialize</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">increase</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'>    <span class="n">synchronize</span> <span class="k">do</span>
</span><span class='line'>      <span class="vi">@n</span> <span class="o">=</span> <span class="vi">@n</span> <span class="o">+</span> <span class="n">x</span>
</span><span class='line'>      <span class="nb">puts</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@n</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[emberä½¿ç”¨expressåšåå°APIæœåŠ¡]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/06/18/ember-nodejs-express-backend-api/"/>
    <updated>2016-06-18T15:00:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/06/18/ember-nodejs-express-backend-api</id>
    <content type="html"><![CDATA[<p>ä½¿ç”¨Ember CLIçš„<code>ember generate server</code>å‘½ä»¤åˆ›å»ºserver,æ¨¡å—ä¼šç”Ÿæˆ<code>server/index.js</code>æ–‡ä»¶ï¼Œè¯¥æœåŠ¡æ˜¯åŸºäºExpressæ¡†æ¶</p>

<pre><code>ember generate server
</code></pre>

<p>server/index.jsé»˜è®¤å†…å®¹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">globSync</span>   <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;glob&#39;</span><span class="p">).</span><span class="nx">sync</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">mocks</span>      <span class="o">=</span> <span class="nx">globSync</span><span class="p">(</span><span class="s1">&#39;./mocks/**/*.js&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">cwd</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="p">}).</span><span class="nx">map</span><span class="p">(</span><span class="nx">require</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">proxies</span>    <span class="o">=</span> <span class="nx">globSync</span><span class="p">(</span><span class="s1">&#39;./proxies/**/*.js&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">cwd</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="p">}).</span><span class="nx">map</span><span class="p">(</span><span class="nx">require</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Log proxy requests</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">morgan</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;morgan&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">morgan</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">mocks</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">route</span><span class="p">)</span> <span class="p">{</span> <span class="nx">route</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span> <span class="p">});</span>
</span><span class='line'>  <span class="nx">proxies</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">route</span><span class="p">)</span> <span class="p">{</span> <span class="nx">route</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span> <span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä»å†…å®¹åˆ†æå¯ä»¥çœ‹å‡ºï¼Œå…¶å®è¿™ä¸ªæœåŠ¡å¯ä»¥è®©å‰ç«¯æ›´å¥½çš„mock APIçš„æ•°æ®åšæµ‹è¯•ï¼Œè¿™æ ·åœ¨å·¥ä½œé…åˆä¸Šå‰ç«¯ä¸éœ€è¦ç­‰åç«¯APIè°ƒå¼
å¯ä»¥ä½¿ç”¨serveræ¨¡æ‹Ÿæ•°æ®ï¼›</p>

<p>ä¹Ÿå¯ä»¥è‡ªå®šä¹‰APIæ•°æ®æ¥å£</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// server/index.js</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;body-parser&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}));</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/items/:item&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">localdb</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">item</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">item</span><span class="o">:</span> <span class="nx">item</span> <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿è¡ŒæœåŠ¡</p>

<pre><code>ember server
</code></pre>

<p>æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>http://localhost:4200/api/items/1</code>APIè·å–æ•°æ®</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[emberå®¹å™¨æ³¨å…¥å¯¹è±¡]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/05/19/ember-inject-container/"/>
    <updated>2016-05-19T22:31:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/05/19/ember-inject-container</id>
    <content type="html"><![CDATA[<blockquote><p>Emberæ³¨å…¥æ˜¯ç”¨æ¥å°†ä¸€ä¸ªå¯¹è±¡æ³¨å…¥åˆ°ä¸€ä¸ªå®¹å™¨é‡Œé¢å»ï¼Œè®©å®¹å™¨å¯ä»¥è®¿é—®å¯¹è±¡ï¼Œå®¹å™¨æ˜¯æŒ‡<code>route</code>ã€<code>controller</code>ã€<code>helper</code>ã€‚</p></blockquote>

<p>ä½¿ç”¨ç”¨ä¾‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// app/services/session.js</span>
</span><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Service</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">isAuthenticated</span><span class="o">:</span> <span class="kc">false</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// app/initializes/inject-session.js</span>
</span><span class='line'><span class="kr">export</span> <span class="kd">function</span> <span class="nx">initialize</span><span class="p">(</span><span class="nx">application</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">application</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="s1">&#39;route&#39;</span><span class="p">,</span> <span class="s1">&#39;service:session&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;session&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">initialize</span><span class="o">:</span> <span class="nx">initialize</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// app/routes/products.js</span>
</span><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">model</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">session</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">setupController</span><span class="p">(</span><span class="nx">controller</span><span class="p">,</span> <span class="nx">model</span><span class="p">){</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">session</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[intersection-of-two-arrays]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/05/19/intersection-of-two-arrays/"/>
    <updated>2016-05-19T22:07:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/05/19/intersection-of-two-arrays</id>
    <content type="html"><![CDATA[<p>Given two arrays, write a function to compute their intersection.</p>

<p>Example:
Given nums1 = [1, 2, 2, 1], nums2 = [2, 2], return [2].</p>

<p>Note:
Each element in the result must be unique.
The result can be in any order.</p>

<pre><code># @param {Integer[]} nums1
# @param {Integer[]} nums2
# @return {Integer[]}
def intersection(nums1, nums2)
  nums1 &amp; nums2
end
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reverse Vowels of a String]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/05/14/leet-code-reverse-vowels/"/>
    <updated>2016-05-14T17:51:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/05/14/leet-code-reverse-vowels</id>
    <content type="html"><![CDATA[<p>Write a function that takes a string as input and reverse only the vowels of a string.</p>

<p>Example 1:
Given s = &#8220;hello&#8221;, return &#8220;holle&#8221;.</p>

<p>Example 2:
Given s = &#8220;leetcode&#8221;, return &#8220;leotcede&#8221;.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># @param {String} s</span>
</span><span class='line'><span class="c1"># @return {String}</span>
</span><span class='line'><span class="k">def</span> <span class="nf">reverse_vowels</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span class='line'>  <span class="n">tmp</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="o">[]</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="sr">/(a|e|i|o|u)/i</span> <span class="o">=~</span> <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="p">?</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="p">:</span> <span class="n">s</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">tmp</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">fdiv</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">ceil</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">v</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span> <span class="n">tmp</span><span class="o">[</span><span class="n">tmp</span><span class="o">.</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="o">]</span>
</span><span class='line'>    <span class="n">a</span><span class="o">[</span><span class="n">v</span><span class="o">]</span><span class="p">,</span> <span class="n">a</span><span class="o">[</span><span class="n">b</span><span class="o">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">[</span><span class="n">b</span><span class="o">]</span><span class="p">,</span> <span class="n">a</span><span class="o">[</span><span class="n">v</span><span class="o">]</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&amp;&amp;</span> <span class="n">b</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">a</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å½“ä½ çš„Sublimeæ‰“å¼€é¡¹ç›®å¡é¡¿çš„æ—¶å€™ä¿®æ”¹é…ç½®]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/03/13/sublime-folder-exclude-patterns/"/>
    <updated>2016-03-13T22:28:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/03/13/sublime-folder-exclude-patterns</id>
    <content type="html"><![CDATA[<p>èœå•è·¯å¾„<code>Preferences -&gt; Settings-User</code></p>

<pre><code>"folder_exclude_patterns": [".svn", ".git", ".hg", "CVS", "node_modules", "bower_components", "tmp"]
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[devise wardenæŠ¥é”™401]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/03/12/devise-authenticate-401/"/>
    <updated>2016-03-12T23:41:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/03/12/devise-authenticate-401</id>
    <content type="html"><![CDATA[<p>ä»Šå¤©é‡åˆ°ä¸€ä¸ªç‰¹åˆ«çš„é—®é¢˜åœ¨é¡¹ç›®é‡Œé¢ä½¿ç”¨deviseåº”ç”¨åˆ°Userä¸Admin, å› ä¸ºUseræ˜¯å¯ä»¥ç”¨æ‰‹æœºå·ç å’ŒEmailç™»å½•çš„,
è€ŒAdminåªèƒ½é‚®ä»¶ç™»å½•ï¼Œç»“æœUserå¯ä»¥æ­£å¸¸ç™»å½•ï¼Œä½†æ˜¯Adminåº”è¯¥ä¹Ÿå¯ä»¥æ­£å¸¸ç™»å½•ï¼Œä½†æ˜¯å°±æ˜¯æŠ¥401å¯†ç é”™è¯¯ï¼Œç»è¿‡ç¿»çœ‹æºç å‘ç°ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œæ‰¾åˆ°å‡ºç°é—®é¢˜çš„åŸå› </p>

<pre><code>(byebug) Devise::Models.check_fields!(Admin)
*** Devise::Models::MissingAttribute Exception: The following attribute(s) is (are) missing on your model: phone
</code></pre>

<p>å› ä¸ºæˆ‘åœ¨devise.rbé…ç½®äº†</p>

<pre><code>config.authentication_keys = [:email, :phone]
</code></pre>

<p>æ‰€ä»¥æˆ‘è¦åœ¨Adminæ¨¡å‹é‡Œé¢æŒ‡å®šauthentication_keys</p>

<pre><code>devise :database_authenticatable, :registerable,
     :recoverable, :rememberable, :trackable, :validatable,
     :authentication_keys =&gt; [:email]
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ember-cliå…¥é—¨æŒ‡å—]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/03/10/ember-cli-guide/"/>
    <updated>2016-03-10T23:02:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/03/10/ember-cli-guide</id>
    <content type="html"><![CDATA[<h4>ember-cliæ˜¯ä»€ä¹ˆï¼Ÿ</h4>

<p>  ember-cliæ˜¯ä¸€ä¸ªember.jsæä¾›çš„ä¸€ä¸ªå¿«é€Ÿå¼€å‘å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æ„å»ºã€è¿è¡Œã€æµ‹è¯•ã€éƒ¨ç½²ï¼Œå¾ˆæ–¹ä¾¿
å‰åç«¯åˆ†ç¦»ï¼Œè€Œä¸”emberæœ‰å¾ˆä¸°å¯Œçš„<a href="https://www.emberaddons.com/">addon</a>ç”Ÿæ€ç¤¾åŒºï¼ŒæŠŠé‡ç”¨çš„ä¸œè¥¿ç»„ä»¶åŒ–ï¼Œ
é¡¹ç›®å¼€å‘å®Œæˆç”¨buildå‘½ä»¤ä¼šè¾“å‡ºä¸€ä¸ªindex.htmlå’Œç¼–è¯‘å¥½çš„jsã€cssæ–‡ä»¶è¿™ä¸ªè¾“å‡ºå°±æ˜¯é™æ€çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨nginxæˆ–node expressæœåŠ¡å™¨æ¥å±•ç°ç¼–è¯‘å¥½çš„é™æ€èµ„æºï¼Œå…¶å®ember-cliçš„å‘½ä»¤è¡Œå·¥å…·è®¾è®¡çš„è·ŸRails Commandç›¸ä¼¼ï¼Œaddonå°±æ˜¯rubyçš„gemåŒ…å¯èƒ½
æ˜¯å› ä¸ºemberçš„å¼€å‘ä¹Ÿæ˜¯Railsæ ¸å¿ƒè´¡çŒ®å¼€å‘ï¼Œæ‰€ä»¥å¾ˆå¤šè®¾è®¡æ€æƒ³äº’é€šã€‚</p>

<h4>å‘½ä»¤ä»‹ç»</h4>

<pre><code>//æ„å»ºé¡¹ç›®
$ ember new todo

//è¿è¡Œé¡¹ç›®
$ ember s

//ç”Ÿæˆè·¯ç”±
$ ember generate route products/new

//è¿è¡Œæµ‹è¯•
$ ember test

//å®‰è£…addon
$ ember install &lt;addon-name&gt;
</code></pre>

<h4>ç›®å½•ç»“æ„</h4>

<pre><code>app/    =&gt; ä¸»è¦åŒ…å«äº†modelsã€controllerã€minxinã€routesã€templateã€index.htmlã€applicationæ‰€æœ‰é¡¹ç›®ç›¸å…³é€»è¾‘ä»£ç å¤šä¼šåœ¨è¿™é‡Œé¢
dist/   =&gt; ç¼–è¯‘è¾“å‡ºç›®å½•é‡Œé¢index.htmlå’Œjsã€css
public/   =&gt; å­˜æ”¾ä¸€äº›é™æ€æ–‡ä»¶ä¾‹å¦‚ï¼šå›¾ç‰‡ã€å­—ä½“
tests/    =&gt; æµ‹è¯•é€»è¾‘
bower_components/    =&gt; boweråŒ…ä¾èµ–æºæ–‡ä»¶
node_modules/     =&gt; npmåŒ…ä¾èµ–æºæ–‡ä»¶
vendor/   =&gt; è‡ªå·±æ‰©å±•ä¾èµ–
ember-cli-build.js  =&gt; æŒ‡å®šç¼–è¯‘é…ç½®æ–‡ä»¶
bower.json   =&gt; bowerä¾èµ–é…ç½®
package.json    =&gt; npmä¾èµ–é…ç½®
</code></pre>

<h4>config/environment.js</h4>

<pre><code>module.exports = function(environment) {
  var ENV = {
    modulePrefix: 'todo',
    environment: environment,
    baseURL: '/',
    locationType: 'hash',  
    contentSecurityPolicy: {
      'connect-src': "'self' * localhost:3000",
      'img-src': "'self' * data:",
      'style-src': "'self' 'unsafe-inline'"
    }
  };

  if(environment === 'development') {
  }

  if (environment === 'test') {
    ENV.APP.rootElement = '#ember-testing';
  }

  if (environment === 'production') {
  }

  return ENV;
};
</code></pre>

<h4>bowerä¸npmåŒºåˆ«</h4>

<p>  boweræ˜¯ç®¡ç†å‰ç«¯åº“ã€npmæ˜¯ç®¡ç†nodoå¼€å‘ä½¿ç”¨åº“ï¼Œå‰è€…æ˜¯æ‰å¹³åŒ–åè€…æ˜¯æ ‘å½¢ç»“æ„ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ£€æµ‹æœåŠ¡å™¨ç½‘ç»œtracerouteå·¥å…·æ”¶é›†]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/02/21/devops-traceroute/"/>
    <updated>2016-02-21T00:09:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/02/21/devops-traceroute</id>
    <content type="html"><![CDATA[<p>tracerouteè¿½è¸ªç½‘ç»œè·¯ç”±å·¥å…·ï¼Œå¯ä»¥å¾ˆè¯¦ç»†çš„çœ‹åˆ°ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ¯è·³è·¯ç”±ä¸è®¿é—®çŠ¶æ€ä¸æ—¶é—´</p>

<h4>ç½‘å…³å‡ºç°é—®é¢˜</h4>

<pre><code>$ traceroute 10.1.2.5                                               
traceroute to 10.1.2.5 (10.1.2.5), 64 hops max, 52 byte packets
 1  192.168.1.1 (192.168.1.1)  1.265 ms  0.643 ms  0.660 ms
 2  10.1.1.1 (10.1.1.1)  1.166 ms  1.250 ms  1.115 ms
 3  218.19.177.1 (218.19.177.1)  3.438 ms  5.116 ms  2.960 ms
 4  58.62.222.33 (58.62.222.33)  5.073 ms  3.072 ms  3.620 ms
 5  * * *
 6  * * *
 7  * * *
 8  * * *
</code></pre>

<p>è¿½è¸ªå½“å‰ç”µè„‘ä¸10.1.2.5ä¹‹é—´çš„æ¯ä¸€è·³è·¯ç”±ï¼Œä»ä¸Šé¢ä¿¡æ¯å¯ä»¥çœ‹åˆ°äº†ç¬¬5æ­¥æ—¶å€™å˜æˆæ˜Ÿå·è¯´æ˜
é—®é¢˜å‡ºåœ¨ç½‘å…³ï¼Œä½ éœ€è¦æ£€æŸ¥è¿™æ¡è·¯çº¿ï¼Œæ’æŸ¥ä¸èƒ½å†ä¸¤ä¸ªç½‘ç»œä¸­ä¼ é€’æ•°æ®åŒ…çš„åŸå› ã€‚</p>

<h4>è¿æ¥ç½‘å…³è¶…æ—¶</h4>

<pre><code>$ traceroute 10.1.2.5                                               
traceroute to 10.1.2.5 (10.1.2.5), 64 hops max, 52 byte packets
 1  192.168.1.1 (192.168.1.1)  1.265 ms  0.643 ms  0.660 ms
 2  10.1.1.1 (10.1.1.1)  3006.47 ms !H  3006.77 ms !H  3007 ms
</code></pre>

<p>è¿™ä¸ªä¾‹å­ä¸­è¿æ¥ç½‘å…³è¶…æ—¶ï¼Œæ‰€æœ‰ä¸»æœºå¯èƒ½å·²ç»å®•æœº</p>

<h4>è¯Šæ–­ç½‘è·¯æ…¢</h4>

<pre><code>$ traceroute yohoo.cn
traceroute to 212.82.102.24 (212.82.102.24), 64 hops max, 52 byte packets
 1  192.168.1.1 (192.168.1.1)  2.370 ms  1.435 ms  0.616 ms
 2  10.1.1.1 (10.1.1.1)  1.140 ms  3.270 ms  1.317 ms
 3  218.19.177.1 (218.19.177.1)  3.620 ms  3.441 ms  5.840 ms
 4  183.56.38.189 (183.56.38.189)  17.443 ms  2.369 ms  3.142 ms
 5  121.8.223.5 (121.8.223.5)  5.467 ms  8.928 ms
    61.144.3.10 (61.144.3.10)  4.603 ms
 6  * 202.97.35.246 (202.97.35.246)  106.464 ms  113.461 ms
 7  202.97.91.234 (202.97.91.234)  107.816 ms
    202.97.60.42 (202.97.60.42)  109.543 ms
    202.97.34.90 (202.97.34.90)  105.858 ms
 8  202.97.58.38 (202.97.58.38)  613.035 ms  408.620 ms  314.500 ms
</code></pre>

<p>è¿™æ˜¯yahooæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡çœ‹æ¯ä¸€è·³ä¹‹é—´çš„æ—¶é—´å¾—å‡ºå‡è®¾ï¼Œå½“ä½ åˆ°è¾¾ç¬¬6è·³æ—¶ä»4msè·³è·ƒåˆ°113msè¿™è¯´æ˜å·²ç»ç¦»å¼€æœ¬åŒºåŸŸäº†æ˜¯ä»ä¸­å›½
é›…è™æœåŠ¡å™¨åˆ°ç¾å›½é›…è™æœåŠ¡å™¨è·³è·ƒã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æœåŠ¡å™¨æ€§èƒ½é—®é¢˜æ£€æµ‹å·¥å…·æ”¶é›†]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/01/28/op-performance/"/>
    <updated>2016-01-28T20:55:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/01/28/op-performance</id>
    <content type="html"><![CDATA[<p>é€šè¿‡ä¸‹é¢è¿™äº›å·¥å…·æ›´å¥½çš„å¯¹æœºå™¨é—®é¢˜è¿›è¡Œè¯Šæ–­</p>

<h4>uptime</h4>

<pre><code>$ uptime                                                        
21:07:48 up 16 days,  7:04,  1 user,  load average: 5.34, 4.70, 4.43
</code></pre>

<p>è¿™ä¸ªå‘½ä»¤å¯ä»¥å¿«é€ŸæŸ¥çœ‹æœºå™¨çš„è´Ÿè½½æƒ…å†µï¼Œè¿™äº›æ•°æ®è¡¨ç¤ºç­‰å¾…CPUèµ„æºçš„è¿›ç¨‹å’Œå µå¡ä¸å¯ä»¥ä¸­æ–­IOè¿›ç¨‹(è¿›ç¨‹çŠ¶æ€ä¸ºD)çš„æ•°é‡
è¿™äº›æ•°æ®å¯ä»¥è®©æˆ‘ä»¬å¯¹ç³»ç»Ÿæœ‰ä¸€ä¸ªå®è§‚çš„äº†è§£ã€‚</p>

<p>è§£è¯»è¾“å‡ºï¼šä»¥é€—å·éš”å¼€ç¬¬ä¸€éƒ¨åˆ†æ˜¯ç³»ç»Ÿè¿è¡Œçš„æ—¶é—´ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ç™»å½•ç”¨æˆ·ï¼Œç¬¬ä¸‰éƒ¨åˆ†æ˜¯è´Ÿè½½å¹³å‡é‡ã€‚è´Ÿè½½é‡è¶Šä½æ„å‘³ç€ä½ çš„ç³»ç»Ÿæ€§èƒ½è¶Šå¥½</p>

<h4>dmesg</h4>

<pre><code>$ dmesg                                                        
[    0.000000] Initializing cgroup subsys cpuset
[    0.000000] Initializing cgroup subsys cpu
[    0.000000] Linux version 3.2.0-24-generic (buildd@komainu) (gcc version 4.6.3 (Ubuntu/Linaro 4.6.3-1ubuntu5) ) #38-Ubuntu SMP Tue May 1 16:18:50 UTC 2012 (Ubuntu 3.2.0-24.38-generic 3.2.16)
[    0.000000] Command line: BOOT_IMAGE=/vmlinuz-3.2.0-24-generic root=/dev/mapper/Apollo-root ro quiet rootdelay=35
[    0.000000] KERNEL supported cpus:
[    0.000000]   Intel GenuineIntel
[    0.000000]   AMD AuthenticAMD
[    0.000000]   Centaur CentaurHauls
[    0.000000] BIOS-provided physical RAM map:
[    0.000000]  BIOS-e820: 0000000000000000 - 00000000000a0000 (usable)
[    0.000000]  BIOS-e820: 0000000000100000 - 00000000cf379000 (usable)
[    0.000000]  BIOS-e820: 00000000cf379000 - 00000000cf38f000 (reserved)
[    0.000000]  BIOS-e820: 00000000cf38f000 - 00000000cf3ce000 (ACPI data)
[    0.000000]  BIOS-e820: 00000000cf3ce000 - 00000000d0000000 (reserved)
[    0.000000]  BIOS-e820: 00000000e0000000 - 00000000f0000000 (reserved)
[    0.000000]  BIOS-e820: 00000000fe000000 - 0000000100000000 (reserved)
[    0.000000]  BIOS-e820: 0000000100000000 - 0000000430000000 (usable)
[    0.000000] NX (Execute Disable) protection: active
[    0.000000] DMI 2.6 present.
[    0.000000] DMI: Dell Inc. PowerEdge R410/0WWR83, BIOS 1.9.0 10/21/2011
[    0.000000] e820 update range: 0000000000000000 - 0000000000010000 (usable) ==&gt; (reserved)
[    0.000000] e820 remove range: 00000000000a0000 - 0000000000100000 (usable)
[    0.000000] No AGP bridge found.....
</code></pre>

<p>å‘½ä»¤æ˜¾ç¤ºlinuxå†…æ ¸çš„ç¯å½¢ç¼“å†²åŒºä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸­è·å¾—è¯¸å¦‚ç³»ç»Ÿæ¶æ„ã€cpuã€æŒ‚è½½çš„ç¡¬ä»¶ï¼ŒRAMç­‰å¤šä¸ªè¿è¡Œçº§åˆ«çš„å¤§é‡çš„ç³»ç»Ÿä¿¡æ¯ã€‚å½“è®¡ç®—æœºå¯åŠ¨æ—¶ï¼Œç³»ç»Ÿå†…æ ¸ï¼ˆæ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒéƒ¨åˆ†ï¼‰å°†ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ã€‚åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºå¾ˆå¤šçš„ä¿¡æ¯ï¼Œåœ¨è¿™äº›ä¿¡æ¯ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å†…æ ¸æ£€æµ‹ç¡¬ä»¶è®¾å¤‡ã€‚</p>

<h4>vmstat</h4>

<pre><code>$ vmstat 1
procs -----------memory---------- ---swap-- -----io---- -system-- ----cpu----
r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa
4  0 2546312 255760 147032 610412    2    2     9    76    1    7 61  4 33  2
</code></pre>

<p>æ¯è¡Œä¼šè¾“å‡ºä¸€äº›ç³»ç»Ÿæ ¸å¿ƒæŒ‡æ ‡ï¼Œè¿™äº›æŒ‡æ ‡å¯ä»¥è®©æˆ‘ä»¬æ›´è¯¦ç»†çš„äº†è§£ç³»ç»ŸçŠ¶æ€ã€‚åé¢è·Ÿçš„å‚æ•°1ï¼Œè¡¨ç¤ºæ¯ç§’è¾“å‡ºä¸€æ¬¡ç»Ÿè®¡ä¿¡æ¯ï¼Œè¡¨å¤´æç¤ºäº†æ¯ä¸€åˆ—çš„å«ä¹‰ï¼Œè¿™å‡ ä»‹ç»ä¸€äº›å’Œæ€§èƒ½è°ƒä¼˜ç›¸å…³çš„åˆ—</p>

<p>  rï¼šç­‰å¾…åœ¨CPUèµ„æºçš„è¿›ç¨‹æ•°ã€‚è¿™ä¸ªæ•°æ®æ¯”å¹³å‡è´Ÿè½½æ›´åŠ èƒ½å¤Ÿä½“ç°CPUè´Ÿè½½æƒ…å†µï¼Œæ•°æ®ä¸­ä¸åŒ…å«ç­‰å¾…IOçš„è¿›ç¨‹ã€‚å¦‚æœè¿™ä¸ªæ•°å€¼å¤§äºæœºå™¨CPUæ ¸æ•°ï¼Œé‚£ä¹ˆæœºå™¨çš„CPUèµ„æºå·²ç»é¥±å’Œã€‚ <br/>
  freeï¼šç³»ç»Ÿå¯ç”¨å†…å­˜æ•°ï¼ˆä»¥åƒå­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œå¦‚æœå‰©ä½™å†…å­˜ä¸è¶³ï¼Œä¹Ÿä¼šå¯¼è‡´ç³»ç»Ÿæ€§èƒ½é—®é¢˜ã€‚ä¸‹æ–‡ä»‹ç»åˆ°çš„freeå‘½ä»¤ï¼Œå¯ä»¥æ›´è¯¦ç»†çš„äº†è§£ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨æƒ…å†µã€‚ <br/>
  si, soï¼šäº¤æ¢åŒºå†™å…¥å’Œè¯»å–çš„æ•°é‡ã€‚å¦‚æœè¿™ä¸ªæ•°æ®ä¸ä¸º0ï¼Œè¯´æ˜ç³»ç»Ÿå·²ç»åœ¨ä½¿ç”¨äº¤æ¢åŒºï¼ˆswapï¼‰ï¼Œæœºå™¨ç‰©ç†å†…å­˜å·²ç»ä¸è¶³ã€‚ <br/>
  us, sy, id, wa, stï¼šè¿™äº›éƒ½ä»£è¡¨äº†CPUæ—¶é—´çš„æ¶ˆè€—ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºç”¨æˆ·æ—¶é—´ï¼ˆuserï¼‰ã€ç³»ç»Ÿï¼ˆå†…æ ¸ï¼‰æ—¶é—´ï¼ˆsysï¼‰ã€ç©ºé—²æ—¶é—´ï¼ˆidleï¼‰ã€IOç­‰å¾…æ—¶é—´ï¼ˆwaitï¼‰å’Œè¢«å·èµ°çš„æ—¶é—´ï¼ˆstolenï¼Œä¸€èˆ¬è¢«å…¶ä»–è™šæ‹Ÿæœºæ¶ˆè€—ï¼‰ã€‚</p>

<h4>mpstat</h4>

<pre><code>$ mpstat -P ALL 1    
Linux 3.2.0-24-generic  01/28/2016  _x86_64_  (4 CPU)

09:29:33 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle
09:29:34 PM  all   76.69    0.00    3.51    5.51    0.00    0.00    0.00    0.00   14.29
09:29:34 PM    0   99.01    0.00    0.99    0.00    0.00    0.00    0.00    0.00    0.00
09:29:34 PM    1  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00
09:29:34 PM    2   48.98    0.00    6.12   13.27    0.00    0.00    0.00    0.00   31.63
09:29:34 PM    3   57.58    0.00    7.07   10.10    0.00    0.00    0.00    0.00   25.25
</code></pre>

<p>è¯¥å‘½ä»¤å¯ä»¥æ˜¾ç¤ºæ¯ä¸ªCPUçš„å ç”¨æƒ…å†µï¼Œå¦‚æœæœ‰ä¸€ä¸ªCPUå ç”¨ç‡ç‰¹åˆ«é«˜ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªå•çº¿ç¨‹åº”ç”¨ç¨‹åºå¼•èµ·çš„</p>

<h4>pidstat</h4>

<pre><code>$ pidstat 1                                                 
Linux 3.2.0-24-generic   01/28/2016  _x86_64_  (4 CPU)

09:31:23 PM       PID    %usr %system  %guest    %CPU   CPU  Command
09:31:24 PM      1046    0.00    0.99    0.00    0.99     2  kworker/2:2
09:31:24 PM      2513    0.99    2.97    0.00    3.96     2  node
09:31:24 PM     18578  200.99    0.00    0.00  200.99     1  java
09:31:24 PM     21124    0.99    0.00    0.00    0.99     2  java
09:31:24 PM     27197    0.00    1.98    0.00    1.98     2  pidstat
09:31:24 PM     27228    2.97    0.00    0.00    2.97     3  node
</code></pre>

<p>pidstatå‘½ä»¤è¾“å‡ºè¿›ç¨‹çš„CPUå ç”¨ç‡ï¼Œè¯¥å‘½ä»¤ä¼šæŒç»­è¾“å‡ºï¼Œå¹¶ä¸”ä¸ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®ï¼Œå¯ä»¥æ–¹ä¾¿è§‚å¯Ÿç³»ç»ŸåŠ¨æ€ã€‚å¦‚ä¸Šçš„è¾“å‡ºï¼Œå¯ä»¥çœ‹è§ä¸€ä¸ªJAVAè¿›ç¨‹å ç”¨äº†å°†è¿‘200%çš„CPUæ—¶é—´ï¼Œæ—¢æ¶ˆè€—äº†å¤§çº¦2ä¸ªCPUæ ¸å¿ƒçš„è¿ç®—èµ„æºã€‚</p>

<h4>iostat</h4>

<pre><code>$ iostat -xz 1                                                                  
Linux 3.2.0-24-generic  01/28/2016  _x86_64_  (4 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
          60.65    0.01    4.03    2.38    0.00   32.92

Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda               0.85    19.84    4.07   32.00    35.01   300.28    18.60     0.70   19.37    4.74   21.23   5.05  18.20
dm-0              0.00     0.00    2.92   50.06    26.91   293.12    12.08     1.07   20.23    6.97   21.01   3.42  18.13
dm-1              0.00     0.00    2.02    1.79     8.09     7.16     8.00     1.75  459.97    6.14  972.71   0.70   0.27
</code></pre>

<p>iostatå‘½ä»¤ä¸»è¦ç”¨äºæŸ¥çœ‹æœºå™¨ç£ç›˜IOæƒ…å†µã€‚è¯¥å‘½ä»¤è¾“å‡ºçš„åˆ—ï¼Œä¸»è¦å«ä¹‰æ˜¯ï¼š</p>

<p>  r/s, w/s, rkB/s, wkB/sï¼šåˆ†åˆ«è¡¨ç¤ºæ¯ç§’è¯»å†™æ¬¡æ•°å’Œæ¯ç§’è¯»å†™æ•°æ®é‡ï¼ˆåƒå­—èŠ‚ï¼‰ã€‚è¯»å†™é‡è¿‡å¤§ï¼Œå¯èƒ½ä¼šå¼•èµ·æ€§èƒ½é—®é¢˜ã€‚ <br/>
awaitï¼šIOæ“ä½œçš„å¹³å‡ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚è¿™æ˜¯åº”ç”¨ç¨‹åºåœ¨å’Œç£ç›˜äº¤äº’æ—¶ï¼Œéœ€è¦æ¶ˆè€—çš„æ—¶é—´ï¼ŒåŒ…æ‹¬IOç­‰å¾…å’Œå®é™…æ“ä½œçš„è€—æ—¶ã€‚å¦‚æœè¿™ä¸ªæ•°å€¼è¿‡å¤§ï¼Œå¯èƒ½æ˜¯ç¡¬ä»¶è®¾å¤‡é‡åˆ°äº†ç“¶é¢ˆæˆ–è€…å‡ºç°æ•…éšœã€‚ <br/>
  avgqu-szï¼šå‘è®¾å¤‡å‘å‡ºçš„è¯·æ±‚å¹³å‡æ•°é‡ã€‚å¦‚æœè¿™ä¸ªæ•°å€¼å¤§äº1ï¼Œå¯èƒ½æ˜¯ç¡¬ä»¶è®¾å¤‡å·²ç»é¥±å’Œï¼ˆéƒ¨åˆ†å‰ç«¯ç¡¬ä»¶è®¾å¤‡æ”¯æŒå¹¶è¡Œå†™å…¥ï¼‰ã€‚ <br/>
  %utilï¼šè®¾å¤‡åˆ©ç”¨ç‡ã€‚è¿™ä¸ªæ•°å€¼è¡¨ç¤ºè®¾å¤‡çš„ç¹å¿™ç¨‹åº¦ï¼Œç»éªŒå€¼æ˜¯å¦‚æœè¶…è¿‡60ï¼Œå¯èƒ½ä¼šå½±å“IOæ€§èƒ½ï¼ˆå¯ä»¥å‚ç…§IOæ“ä½œå¹³å‡ç­‰å¾…æ—¶é—´ï¼‰ã€‚å¦‚æœåˆ°è¾¾100%ï¼Œè¯´æ˜ç¡¬ä»¶è®¾å¤‡å·²ç»é¥±å’Œã€‚</p>

<h4>free</h4>

<pre><code>$ free -m
         total       used       free     shared    buffers     cached
Mem:      16420044   16166340     253704          0     146060     611384
-/+ buffers/cache:   15408896    1011148
Swap:     11878396    2545148    9333248
</code></pre>

<p>freeå‘½ä»¤å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨æƒ…å†µ</p>

<h4>sar</h4>

<pre><code>$ sar -n DEV 1
Linux 3.2.0-24-generic   01/28/2016  _x86_64_  (4 CPU)

09:39:12 PM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s
09:39:13 PM        lo     47.00     47.00      5.09      5.09      0.00      0.00      0.00
09:39:13 PM      eth1      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:39:13 PM      eth0     26.00     36.00      3.23      3.01      0.00      0.00      1.00
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[El Capitan ruby-oci8 2.1.4 å®‰è£…æŠ¥é”™]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/01/01/el-capitan-ruby-oci8/"/>
    <updated>2016-01-01T16:31:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/01/01/el-capitan-ruby-oci8</id>
    <content type="html"><![CDATA[<p>å‡çº§MacOS El Capitanåå®‰è£…oracleçš„ruby-oci8 2.1.4ç‰ˆæœ¬gemåŒ…æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  Installing ruby-oci8 2.1.4 with native extensions
</span><span class='line'>
</span><span class='line'>  Gem::Ext::BuildError: ERROR: Failed to build gem native extension.
</span><span class='line'>
</span><span class='line'>  /Users/huxinghai/.rvm/rubies/ruby-2.0.0-p643/bin/ruby -r ./siteconf20151231-1172-1r9gor0.rb extconf.rb
</span><span class='line'>  checking for load library path...
</span><span class='line'>  DYLD_LIBRARY_PATH is not set.
</span><span class='line'>  checking for cc... ok
</span><span class='line'>  checking for gcc... yes
</span><span class='line'>  checking for LP64... yes
</span><span class='line'>  checking for sys/types.h... yes
</span><span class='line'>  checking for ruby header... ok
</span><span class='line'>  Get the version of Oracle from SQL*Plus... 1120
</span><span class='line'>  try  -I/opt/oracle/instantclient_11_2/rdbms/public
</span><span class='line'>  checking for oci.h... no
</span><span class='line'>  try  -I/opt/oracle/instantclient_11_2/rdbms/public -I/opt/oracle/instantclient_11_2/rdbms/demo
</span><span class='line'>  checking for oci.h... no
</span><span class='line'>  try  -I/opt/oracle/instantclient_11_2/rdbms/public -I/opt/oracle/instantclient_11_2/rdbms/demo -I/opt/oracle/instantclient_11_2/network/public
</span><span class='line'>  checking for oci.h... no
</span><span class='line'>  try  -I/opt/oracle/instantclient_11_2/rdbms/public -I/opt/oracle/instantclient_11_2/rdbms/demo -I/opt/oracle/instantclient_11_2/network/public -I/opt/oracle/instantclient_11_2/plsql/public
</span><span class='line'>  checking for oci.h... no
</span><span class='line'>  *** extconf.rb failed ***
</span><span class='line'>  Could not create Makefile due to some reason, probably lack of necessary
</span><span class='line'>  libraries and/or headers.</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>è¿™é‡Œé¢æœ‰ä¸€ä¸ªé‡è¦çš„ä¿¡æ¯<code>DYLD_LIBRARY_PATH is not set</code>ä½†æ˜¯æˆ‘åœ¨<code>~/.bash_profile</code>æ–‡ä»¶é‡Œé¢é…ç½®äº†DYLD_LIBRARY_PATHè·¯å¾„ï¼Œæˆ‘åœ¨ç»ˆç«¯<code>env | grep DYLD_LIBRARY_PATH</code>ä½†æ˜¯ä¸ºç©ºï¼Œåæ¥æˆ‘åœ¨ç»ˆç«¯<code>export DYLD_LIBRARY_PATH=/opt/oracle/instantclient_11_2</code>è¿˜æ˜¯ä¸ºç©ºï¼Œä½†æ˜¯exportå…¶å®ƒçš„ç¯å¢ƒå˜é‡éƒ½æœ‰å€¼ï¼Œåæ¥æŸ¥èµ„æ–™çœ‹åˆ°ä¸€ä¸ªEl Capitan SIPï¼ˆSystem Integrity Protectionï¼‰è¿™ä¸ªè¯ï¼Œgoogleäº†ä¸€ä¸ªSIPæ‰æ˜ç™½æ˜¯El Capitanç‰ˆæœ¬çš„ä¸€ä¸ªå®‰å…¨ç­–ç•¥, SIPæŠŠDYLD_LIBRARY_PATHä¿æŠ¤èµ·æ¥äº†ï¼Œæ‰€ä»¥çš„æŠŠSIPå…³é—­æ‰å¯ä»¥æ­£å¸¸è®¾ç½®DYLD_LIBRARY_PATH, å…³é—­SIPåexport DYLD_LIBRARY_PATHå˜é‡å°±æˆåŠŸäº†ã€‚</p>

<p><a href="http://apple.stackexchange.com/questions/208478/how-do-i-disable-system-integrity-protection-sip-aka-rootless-on-os-x-10-11">å…³é—­SIPæ­¥éª¤</a></p>

<ol>
<li>é‡å¯ç³»ç»Ÿ, åœ¨å¯åŠ¨æ—¶å€™æŒ‰<code>Command+R</code>è¿›å…¥æ¢å¤æ¨¡å¼å›¾å½¢ç•Œé¢</li>
<li>ç‚¹å‡»<code>ä½¿ç”¨å·¥å…·</code> > <code>Terminal</code></li>
<li>åœ¨ç»ˆç«¯è¾“å…¥<code>csrutil disable</code>å‘½ä»¤æŒ‰å›è½¦ï¼Œä¼šæç¤ºæ˜¯å¦æˆåŠŸ</li>
<li>é‡å¯ç³»ç»Ÿ</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å…ƒç¼–ç¨‹Ruby2.0 Module#refine]]></title>
    <link href="http://huxinghai1988.github.com/blog/2015/11/08/module-refine/"/>
    <updated>2015-11-08T00:00:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2015/11/08/module-refine</id>
    <content type="html"><![CDATA[<p>æ²¡æœ‰çœ‹å…ƒç¼–ç¨‹ç¬¬äºŒç‰ˆä¹‹å‰è¿˜ä¸çŸ¥é“Moduleæœ‰<strong><em>refine</em></strong>ç‰¹æ•ˆï¼Œå¯ä»¥å°†ä¸€ä¸ªclassé‡æ–°æ‰“å¼€å®šä¹‰æ–¹æ³•
ç„¶åä½¿ç”¨usingç”Ÿæ•ˆï¼Œè¿™æ ·ä¸ä¼šå½±å“åŸæœ‰classï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ¡ˆä¾‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">FooBar</span>
</span><span class='line'>  <span class="n">refine</span> <span class="nb">String</span> <span class="k">do</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">hello</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2"> says : Hello, world&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Bar</span>
</span><span class='line'>  <span class="n">using</span> <span class="no">FooBar</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:user</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">say</span>
</span><span class='line'>    <span class="n">user</span><span class="o">.</span><span class="n">hello</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Bar</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;ruby&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">say</span>
</span><span class='line'><span class="nb">String</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">say</span>
</span></code></pre></td></tr></table></div></figure>


<p>String.new.sayè°ƒç”¨ä¼šæŠ¥é”™ï¼Œ å› ä¸ºsayåªåœ¨Barç±»é‡Œé¢ç”Ÿæ•ˆã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[emberjs2 è‡ªå®šä¹‰adapteræ–¹æ³•ä¸jsonåºåˆ—åŒ–model]]></title>
    <link href="http://huxinghai1988.github.com/blog/2015/09/22/emberjsguide/"/>
    <updated>2015-09-22T21:50:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2015/09/22/emberjsguide</id>
    <content type="html"><![CDATA[<ol>
<li><p>è‡ªå®šä¹‰adapterè¯·æ±‚æœåŠ¡å™¨</p>

<p> æœ‰æ—¶å€™model CURD æ»¡è¶³ä¸äº†æˆ‘ä»¬çš„éœ€æ±‚ï¼Œéœ€è¦è‡ªå·±å®šä¹‰æ–¹æ³•è¯·æ±‚æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ç§æ–¹æ³•å®šä¹‰adapter
ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code>App.UserAdapter = App.ApplicationAdapter.extend({
  createRelation: function(opts){
    var url = [this.urlPrefix(), "users", "/pass"].join("/")
    return this.ajax(url, "POST", {data: opts})  
  }
})
</code></pre>

<p>controllerè°ƒç”¨</p>

<pre><code>var adapter = this.store.adapterFor("user");
adapter.createRelation({status: 1}).then(function(){
  // success
}, function(){
  // catch
})
</code></pre></li>
<li><p>jsonåºåˆ—åŒ–model</p></li>
</ol>


<p>  <code>
  this.store.push(this.store.normalize("user", {id: 1, name: 'xxxxxxxxx'}))
 </code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[emberjs 2.0 é‡åˆ°ä¸€ä¸ªå‘]]></title>
    <link href="http://huxinghai1988.github.com/blog/2015/09/12/emberjs-pit/"/>
    <updated>2015-09-12T11:52:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2015/09/12/emberjs-pit</id>
    <content type="html"><![CDATA[<p>æœ€è¿‘é¡¹ç›®ä½¿ç”¨emberjs 2.0ç‰ˆæœ¬ï¼Œæœ¬èº«ç”¨2.0æ˜¯æ¯”è¾ƒçº ç»“çš„äº‹ï¼Œç”±äºä¹‹å‰å°±æ˜¯åªé—»å…¶æœ¯ï¼Œä¸è§å…¶ç ï¼Œè€Œä¸”emberjs 1.xç‰ˆæœ¬åˆ°2.0 åšäº†ä¸€æ¬¡æ— ç—›å‡çº§ï¼Œä¹‹å‰ç”¨backboneæ¡†æ¶æ„Ÿè§‰æœ‰äº›æ¦‚å¿µè¿˜æ˜¯ä¸€æ ·çš„ï¼Œå…ˆè¯´è¯´ç”¨çš„emberjs ç¬¬ä¸€ä¸ªå‘è´´ä»£ç ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="c1">//controller js æ–‡ä»¶</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">actions</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">save</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">tag</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">createRecord</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;newName&quot;</span><span class="p">)})</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">tag</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">that</span><span class="p">){</span>
</span><span class='line'>        <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>          <span class="nx">that</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;newName&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}(</span><span class="k">this</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">that</span><span class="p">){</span>
</span><span class='line'>        <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">){</span>
</span><span class='line'>          <span class="nx">tag</span><span class="p">.</span><span class="nx">rolledBack</span><span class="p">()</span>
</span><span class='line'>          <span class="nx">tag</span><span class="p">.</span><span class="nx">unloadRecord</span><span class="p">()</span>
</span><span class='line'>          <span class="nx">that</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;errors&quot;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">errors</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}(</span><span class="k">this</span><span class="p">))</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>tag å½“æˆ‘ä¸ç®¡æˆåŠŸä¸å¤±è´¥template å¤šä¼šåŠ è½½è¿™æ•°æ®ï¼Œæˆ‘æƒ³åœ¨saveå¤±è´¥ä¸åŠ è½½åˆ°templateæ‰€ä»¥è¦åŠ ä¸€ä¸ª<strong>rolledBack</strong>å’Œ<strong>unloadRecord</strong>å¤±è´¥çš„æ—¶å€™å°±ä¸åŠ è½½äº†ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä½¿ç”¨pomeloåšèŠå¤©æœåŠ¡å™¨åˆ†é…connectoræœåŠ¡ä½¿ç”¨httpåˆ†é…]]></title>
    <link href="http://huxinghai1988.github.com/blog/2015/01/11/pomelo-gate-http/"/>
    <updated>2015-01-11T10:10:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2015/01/11/pomelo-gate-http</id>
    <content type="html"><![CDATA[<p>å¦‚æœä½¿ç”¨pomeloé»˜è®¤çš„gateåˆ†é…å¾ˆæ…¢, å› ä¸ºsocketå»è¿æ¥æœåŠ¡ï¼Œç„¶ådisconnectå†è¿æ¥connector
æœåŠ¡å™¨è¿™è¿‡ç¨‹å°±ä¼šæ‹–æ…¢ç”¨æˆ·è¿æ¥æ—¶é—´ï¼Œä½¿ç”¨httpæ–¹ä¾¿è€Œä¸”å¿«ã€‚</p>

<p>pomelo æœ¬èº«æ”¯æŒPluginæ‰©å±•ï¼Œå·²ç»æœ‰äººç”¨expresså†™äº†<a href="https://github.com/pipi32167/pomelo-http-plugin">pomelo-http</a>æ’ä»¶äº†, æ’ä»¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜å®šä¹‰postè¯·æ±‚æ‹¿ä¸åˆ°å‚æ•°, <em>body-parser</em>ä½¿ç”¨å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">dispatcher</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../../util/dispatcher&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">http</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/system/dispatcher&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">c_type</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">c_type</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">uid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">uuid</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">c_type</span> <span class="o">=</span> <span class="p">(</span><span class="nx">c_type</span> <span class="o">&amp;&amp;</span> <span class="nx">c_type</span><span class="o">===</span><span class="s1">&#39;mqtt&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;mqtt-connector&#39;</span> <span class="o">:</span> <span class="s1">&#39;sio-connector&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">connectors</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">getServersByType</span><span class="p">(</span><span class="nx">c_type</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">uid</span><span class="p">,</span> <span class="nx">connectors</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">s</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="nx">error</span><span class="o">:</span> <span class="s2">&quot;not invalid server connectors!!!&quot;</span><span class="p">})</span>
</span><span class='line'>    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="nx">host</span><span class="o">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span> <span class="nx">port</span><span class="o">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">clientPort</span><span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[pomelo centOs ç¯å¢ƒéƒ¨ç½²]]></title>
    <link href="http://huxinghai1988.github.com/blog/2014/12/11/pomelo-deploy/"/>
    <updated>2014-12-11T23:44:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2014/12/11/pomelo-deploy</id>
    <content type="html"><![CDATA[<p>pomeloå¼ºå¤§çš„å¯ä¼¸ç¼©æ€§å’Œçµæ´»æ€§ä½¿å¾—pomeloä¹Ÿå¯ä»¥ä½œä¸ºé€šç”¨çš„åˆ†å¸ƒå¼å®æ—¶åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œç”¨äºä¸€äº›é«˜å®æ—¶åº”ç”¨çš„å¼€å‘ï¼Œè€Œä¸”pomeloåœ¨å¾ˆå¤šæ–¹é¢çš„è¡¨ç°ç”šè‡³è¶…è¶Šäº†ç°æœ‰çš„å¼€æºå®æ—¶åº”ç”¨æ¡†æ¶</p>

<p>ç”±äºpomelo ä¾èµ–node-gypè¿™modulesæ‰€ä»¥æœ‰ç‚¹éº»çƒ¦,å®‰è£…ä¹‹å‰é…ç½®pythonç¯å¢ƒï¼Œå®˜æ–¹æ¨èç‰ˆæœ¬2.7</p>

<pre><code>npm config set python /usr/local/bin/python2.7

npm install -g node-gyp

npm install -g pomelo 

pomelo start -e production --daemon

//host ä¸ port æ˜¯masteråœ°å€
pomelo stop --host 172.0.0.1 --port 4005
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ruby bundle gemçš„é…ç½®]]></title>
    <link href="http://huxinghai1988.github.com/blog/2014/12/10/bundle-config/"/>
    <updated>2014-12-10T14:11:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2014/12/10/bundle-config</id>
    <content type="html"><![CDATA[<p>åœ¨é¡¹ç›®é‡Œæˆ‘ä»¬ç”¨çš„æ¯”è¾ƒå¤šçš„bundle installå½“é‡åˆ°ä¸€äº›gemåŒ…ç¯å¢ƒé—®é¢˜æ—¶ï¼Œåœ¨å®‰è£…gemæ—¶éœ€è¦åŠ ä¸€äº›é…ç½®
æ¯”å¦‚ï¼š</p>

<pre><code>gem install pg -v '0.12.0' -- --with-pg-config=/usr/pgsql-9.1/bin/pg_config
</code></pre>

<p>ä½†æ˜¯å½“æˆ‘ä»¬è¦æŠŠpgåŠ å…¥Gemfileæ–‡ä»¶æ—¶ï¼Œåé¢çš„é…ç½®æ€ä¹ˆè®¾ç½®ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦ç”¨åˆ°bundle configçš„ä¸œè¥¿ï¼Œå¯ä»¥åœ¨bundle
è¯»å–ç›¸åº”çš„é…ç½®, æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹è®¾ç½®ï¼š</p>

<pre><code>bundle config build.pg --with-pg-config=/usr/pgsql-9.1/bin/pg_config
</code></pre>

<p>bundle config è¯¦è§£ï¼š</p>

<pre><code>#æŸ¥çœ‹é…ç½®
bundle config

#æŸ¥çœ‹æŸç§nameçš„é…ç½®
bundle config NAME

#è®¾ç½®å€¼
bundle config NAME VALUE

#è®¾ç½®å…¨å±€
bundle config --global NAME VALUE

#è®¾ç½®å½“å‰ç›®å½•ä¸‹
bundle config --local NAME VALUE 

#åˆ é™¤ä¸€ä¸ªé…ç½®
bundle config --delete NAME
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Railsè°ƒç”¨oracleçš„å­˜å‚¨è¿‡ç¨‹]]></title>
    <link href="http://huxinghai1988.github.com/blog/2014/08/21/oracle-call-stored-procedure/"/>
    <updated>2014-08-21T00:41:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2014/08/21/oracle-call-stored-procedure</id>
    <content type="html"><![CDATA[<p>è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>

<pre><code>cursor = ActiveRecord::Base.connection.raw_connection.parse("BEGIN MYPROC(:age, :name, :fathers_age, :capital_name); END;")
cursor.bind_param(:name, 'akshay')
cursor.bind_param(:age, '20')
cursor.bind_param(:fathers_age, nil, Fixnum)
cursor.bind_param(:capital_name, nil, String, 20)
cursor.exec()
p cursor[:fathers_age], cursor[:capital_name]


require 'sequel'
db = Sequel.connect(:adapter=&gt;'oracle', :host=&gt;'localhost', :database=&gt;'db_name', :user=&gt;'test', :password=&gt;'test')
db.execute("begin MYPROC(:age, :name, :fathers_age, :capital_name); end;", {:arguments =&gt; [[20, "integer"], ["akshay", "string"], [nil, "integer"], [nil, "string"]]}) { |cursor| [cursor[3], cursor[4]] }
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rubyæ ¹æ®ä¸åŒçš„å¼‚å¸¸å¤„ç†ä¸åŒäº‹ä»¶]]></title>
    <link href="http://huxinghai1988.github.com/blog/2014/07/28/rails-raise/"/>
    <updated>2014-07-28T23:39:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2014/07/28/rails-raise</id>
    <content type="html"><![CDATA[<p>åœ¨ä¸€ä¸ª<em>class</em>é‡Œé¢ä½ æƒ³æ ¹æ®ä¸åŒçš„å¼‚å¸¸å›è°ƒä¸åŒäº‹ä»¶</p>

<pre><code>class NoMoneyException &lt; StandardError
end

class ValidNumberException &lt; StandardError
end

class Sale

    def self.create(options)
        obj = new(options)
        obj.validation
    end

    def validation

        raise NoMoneyException if money &gt; current_user.money
        raise ValidNumberException if number &gt; warehouse.nventory
    end
end


begin
    Sale.create({...})
rescue NoMoneyException =&gt; e
    callback ..
rescue ValidNumberException =&gt; e
    callback ..
end
</code></pre>
]]></content>
  </entry>
  
</feed>
