<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: rails | Ka Ka Blog]]></title>
  <link href="http://huxinghai1988.github.com/blog/categories/rails/atom.xml" rel="self"/>
  <link href="http://huxinghai1988.github.com/"/>
  <updated>2016-11-20T13:19:28+08:00</updated>
  <id>http://huxinghai1988.github.com/</id>
  <author>
    <name><![CDATA[kaka]]></name>
    <email><![CDATA[huxinghai1988@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ä½¿ç”¨MySQLå­˜å‚¨emojiè¡¨æƒ…ç¬¦å·]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/09/05/mysql-store-emoji-in-rails-app/"/>
    <updated>2016-09-05T22:40:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/09/05/mysql-store-emoji-in-rails-app</id>
    <content type="html"><![CDATA[<p>ä¸€ä¸ªemojiæ˜¯4bytesçš„å­˜å‚¨ç©ºé—´, å¦‚æœä½ çš„MySQLä½¿ç”¨çš„æ˜¯utf8ç¼–ç æ ¼å¼é‚£emojiç¬¦å·å­˜å‚¨å°†ä¼šæˆªæ–­å­—ç¬¦å› ä¸ºutf8ä¸€ä¸ªå­—ç¬¦åªæ˜¯
3bytesçš„å­˜å‚¨ç©ºé—´</p>

<p>ä¾‹å­ï¼š</p>

<p>```
mysql> SET NAMES utf8;
Query OK, 0 rows affected (0,00 sec)</p>

<p>mysql> INSERT INTO messages (message) VALUES ('What a nice emojiğŸ˜€!');
Query OK, 1 row affected, 1 warning (0,00 sec)</p>

<p>mysql> SHOW WARNINGS;
+---------+------+---------------------------------------------------------------------------+
| Level   | Code | Message                                                                   |
+---------+------+---------------------------------------------------------------------------+
| Warning | 1366 | Incorrect string value: '\xF0\x9F\x98\x80!' for column 'message' at row 1 |
+---------+------+---------------------------------------------------------------------------+
1 row in set (0,00 sec)</p>

<p>mysql> SELECT message FROM messages;
+-------------------+
| message           |
+-------------------+
| What a nice emoji |
+-------------------+
1 row in set (0,00 sec)
```</p>

<p>ä½¿ç”¨utf8mb4æ ¼å¼å¯ä»¥å­˜å‚¨emojiå­—ç¬¦ï¼Œä½†æ˜¯<a href="https://dev.mysql.com/doc/relnotes/mysql/5.5/en/news-5-5-3.html">MySQL 5.5.3</a>ç‰ˆæœ¬æ‰å¼•è¿›utf8mb4ç¼–ç æ ¼å¼ï¼Œæ‰€ä»¥æ•°æ®åº“è¦æ›´æ–°åˆ°è¿™ä¸ªç‰ˆæœ¬æˆ–è€…æ›´é«˜çš„, ç”¨utf8mb4ä¹‹åæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°<code>Mysql2::Error: Specified key was too long; max key length is 767 bytes</code>é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºInnodbçš„ç´¢å¼•é•¿åº¦é™åˆ¶767bytes, (varchar(255) * 4bytes)è¿™ä¸ªæ˜¯ä¼šè¶…è¿‡767bytes</p>

<p>å¦‚æœä½ çš„å­—æ®µç±»å‹é•¿åº¦ä¸èƒ½å‡å°‘ï¼Œé‚£åªèƒ½æ˜¯æŒ‡å®šè¡Œçš„æ ¼å¼æ¥è§£å†³ï¼Œåœ¨åˆ›å»ºè¡¨æ—¶æŒ‡å®š<a href="http://dev.mysql.com/doc/refman/5.6/en/innodb-parameters.html#sysvar_innodb_large_prefix">ROW_FORMAT=DYNAMIC</a>å‚æ•°å¯ä»¥ä»767bytesé™åˆ¶æå‡åˆ°3072bytes, è¿™æ ·å°±æ˜¯ä¼šç‰ºç‰²ä¸€ç‚¹ç©ºé—´</p>

<p>ä¾‹å¦‚:</p>

<p><code>sql
CREATE TABLE `bookmarks` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `url` varchar(255) COLLATE utf8mb4_bin DEFAULT NULL,
  `title` varchar(255) COLLATE utf8mb4_bin DEFAULT NULL,
  `user_id` int(11) NOT NULL,
  `created_at` datetime NOT NULL,
  `updated_at` datetime NOT NULL,
  `site_info_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=25 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin ROW_FORMAT=DYNAMIC
</code></p>

<p>å¦‚æœä½¿ç”¨çš„æ˜¯Railsçš„migrationçš„è¯å°±å¦‚ä¸‹ï¼š</p>

<p>```ruby
class CreateArticles &lt; ActiveRecord::Migration[5.0]
  def change</p>

<pre><code>create_table :articles, options: 'ROW_FORMAT=DYNAMIC' do |t|
  t.string :title, null: false, limit: 300
  t.datetime :published
  t.string :author
  t.text :description
  t.text :content

  t.timestamps
end

add_index :articles, :title, :unique =&gt; true
</code></pre>

<p>  end
end
```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Railsè°ƒç”¨oracleçš„å­˜å‚¨è¿‡ç¨‹]]></title>
    <link href="http://huxinghai1988.github.com/blog/2014/08/21/oracle-call-stored-procedure/"/>
    <updated>2014-08-21T00:41:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2014/08/21/oracle-call-stored-procedure</id>
    <content type="html"><![CDATA[<p>è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>

<pre><code>cursor = ActiveRecord::Base.connection.raw_connection.parse("BEGIN MYPROC(:age, :name, :fathers_age, :capital_name); END;")
cursor.bind_param(:name, 'akshay')
cursor.bind_param(:age, '20')
cursor.bind_param(:fathers_age, nil, Fixnum)
cursor.bind_param(:capital_name, nil, String, 20)
cursor.exec()
p cursor[:fathers_age], cursor[:capital_name]


require 'sequel'
db = Sequel.connect(:adapter=&gt;'oracle', :host=&gt;'localhost', :database=&gt;'db_name', :user=&gt;'test', :password=&gt;'test')
db.execute("begin MYPROC(:age, :name, :fathers_age, :capital_name); end;", {:arguments =&gt; [[20, "integer"], ["akshay", "string"], [nil, "integer"], [nil, "string"]]}) { |cursor| [cursor[3], cursor[4]] }
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[mongoid ä½¿ç”¨ajax æ— åˆ·æ–°ä¸Šä¼ ]]></title>
    <link href="http://huxinghai1988.github.com/blog/2012/12/08/ajax-upload-avatar/"/>
    <updated>2012-12-08T14:43:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2012/12/08/ajax-upload-avatar</id>
    <content type="html"><![CDATA[<p>ä½¿ç”¨ä»¥ä¸‹çš„gemåŒ…:</p>

<pre>
    gem 'carrierwave'
    gem 'carrierwave-mongoid', :require => 'carrierwave/mongoid'
    gem 'mini_magick'
    gem 'rack-raw-upload'
</pre>




<p>
ç„¶åå‰ç«¯jsï¼Œæœ¬æ¥ä½¿ç”¨<a href='http://fineuploader.com'>fineuploader</a>ï¼Œä½†æ˜¯åœ¨ie8ä¸‹é¢æœ‰é—®é¢˜,åŸå› æ˜¯ajax send çš„æ—¶å€™å¤´éƒ¨<br />
ä¿¡æ¯ç±»å‹<code>Content-Type: multipart/form-data</code>,è€Œå…¶å®ƒæµè§ˆå¤´éƒ¨ç±»å‹æ­£å¸¸ï¼Œä½†æ˜¯å®˜æ–¹è¯´æ”¯æŒie 7ä»¥ä¸Šï¼Œä½†æ˜¯å¼„äº†å¾ˆä¹…ï¼Œè¿˜æ˜¯ä¸è¡Œ<br />
å†³å®šä½¿ç”¨<a href='https://github.com/Valums-File-Uploader/file-uploader.git'>file-uploader</a>å‰ç«¯ï¼Œè¿™ä½¿ç”¨æ–¹å¼å¾ˆé›·åŒï¼Œä½¿ç”¨file-uploaderåœ¨ie 8ä¸‹é¢ï¼Œä½†å½“æœåŠ¡å™¨è¿”å›çŠ¶æ€ä¸ç­‰äº200æ—¶ï¼Œä¼šå‡ºç°é”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯è¯´iframe.contentDocument æ²¡æœ‰æƒé™ï¼é€šè¿‡å…¶å®ƒçŠ¶æ€å¤„ç†é”™è¯¯ä¿¡æ¯!
</p>

]]></content>
  </entry>
  
</feed>
